



Once our MSFconsole is loaded, let’s search for exploits pertaining to Windows XP that we can use to gain access to our target system.



At first glance, the results returned can be overwhelming. We have tons of resources to help us find the most suitable exploit for the job. 

In this case, one our returned exploits is “MS08-067 Microsoft Server Service Relative Path Stack Corruption”. Windows XP is vulnerable to this exploit and has not only a perfect score of 10/10 on CVE Details, but Metasploit ranks it as “great”. Great for us, bad for our victim.

Now that we have identified a possible exploit to use, let’s load the exploit into our MSFconsole and configure it to target and exploit the vulnerability on our victims machine

After loading our exploit, we can use show options to show us the list of configurable parameters for this specific exploit

* RHOST: The remote target address \(in our case, the Windows XP machine located at 192.168.5.129\)

* RPORT: The remote port that the SMB service runs on. In this case, Metasploit automatically configured it for us to use the default SMB port – port 445.
* SMBPIPE: The pipe name to use. Again, Metasploit came in handy and pre-configured this for us.
* Exploit target: This setting tells Metasploit specifically what OS version our target is running. In this case, Metasploit is able to automatically identify and exploit the correct target OS.

Let’s set the RHOST \(remote host\) setting. We will type: Set RHOST 192.168.5.129 We can then use the check command to have Metasploit check and see if our target is vulnerable to this specific exploit. While not available for all exploits, this ability is very useful in seeing whether or not your chosen exploit will work against the target system.

At this point, we are ready to use our exploit and gain access to the system. The beauty of MSFconsole is its ability to make everything so simple for us. All we have to do is type exploit, and hit enter!



---



Success! Metasploit was able to successfully exploit the vulnerability and deliver our payload. By default, Metasploit delivered a Meterpreter payload. As we learned above, Meterpreter is an advanced, dynamic payload that was designed to be stealthy, powerful, and extensible. Allowing us to interact with our victim in many useful ways.

Armed with an exploited machine and a meterpreter session, we can begin to interact with our victim. The power we have now gained over our target is immense. Using Meterpreter, we can upload, download, read, delete, and edit remote files. Meterpreter can also run commands on the target, dump password hashes, and even view the webcam along with many other useful commands.



---

Before we have any fun, however, let’s see what user and process our Meterpreter shell is running as. Meterpreter is successful because it is able to inject itself into a running process \(in memory\) on the vulnerable system and seemingly make everything look normal. 

We can type`getuid`and`getpid`to get the user ID and process ID of our running Meterpreter shell. Then, type`ps`to see the process list on the target system.



We see we are running as svchost.exe and as a SYSTEM user. The SYSTEM user is the highest level of rights and access you can have on a machine, higher than the Administrator! Before we can spy on our user and take a screenshot of what they are doing, we need to migrate our Meterpreter shell from the svchost.exe process to the explorer.exe process. We also must first activate a built-in script module in Meterpreter called **espia **by typing`meterpreter>useespia`

Then, migrate the meterpreter shell over to the Explorer.exe process. This will gives us more control and options over our system. Use the migrate command to migrate to the corresponding PID of Explorer.exe. 

With espia loaded and our Meterpreter shell running as Explorer.exe, we can type`meterpreter>screengrab`and Meterpreter will take a screenshot on the target machine and send it to us.





**Conclusion**

By exploiting a vulnerable operating system, we were able to deliver a Meterpreter payload that allowed us to interact with the target machine. On this machine we found intelligence in the form of two different documents, the employee list and the company password policy, that may help us further our attack against Queen City Construction.









